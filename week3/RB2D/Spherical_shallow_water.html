
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>&lt;no title&gt; &#8212; Chaos and Predictability</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Chaos and Predictability</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Syllabus
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../week1/week1.html">
   Week 1: Predictability of Weather and Climate
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../week2/week2.html">
   Week 2: Predictability source in atmosphere
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week3.html">
   Week 3: The minimalist models for studying chaos and predictability I: Lorenz 63
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../week4/week4.html">
   Week 4: The minimalist models for studying chaos and predictability II: Lorenz 96
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../week5/week5.html">
   Week 5: The connection between statistical mechanics and ensemble forecast I: Theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../week6/week6.html">
   Week 6: The connection between statistical mechanics and ensemble forecast I: Applications
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/week3/RB2D/Spherical_shallow_water.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/kuiper2000/chaos_and_predictability"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/kuiper2000/chaos_and_predictability/issues/new?title=Issue%20on%20page%20%2Fweek3/RB2D/Spherical_shallow_water.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/kuiper2000/chaos_and_predictability/master?urlpath=tree/docs/week3/RB2D/Spherical_shallow_water.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="simple visible nav section-nav flex-column">
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1><no title></h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="simple visible nav section-nav flex-column">
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Dedalus script simulating the viscous shallow water equations on a sphere. This</span>
<span class="sd">script demonstrates solving an initial value problem on the sphere. It can be</span>
<span class="sd">ran serially or in parallel, and uses the built-in analysis framework to save</span>
<span class="sd">data snapshots to HDF5 files. The `plot_sphere.py` script can be used to produce</span>
<span class="sd">plots from the saved data. The simulation should a few cpu-minutes to run.</span>

<span class="sd">The script implements the test case of a barotropically unstable mid-latitude</span>
<span class="sd">jet from Galewsky et al. 2004 (https://doi.org/10.3402/tellusa.v56i5.14436).</span>
<span class="sd">The initial height field balanced the imposed jet is solved with an LBVP.</span>
<span class="sd">A perturbation is then added and the solution is evolved as an IVP.</span>

<span class="sd">To run and plot using e.g. 4 processes:</span>
<span class="sd">    $ mpiexec -n 4 python3 shallow_water.py</span>
<span class="sd">    $ mpiexec -n 4 python3 plot_sphere.py snapshots/*.h5</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">dedalus.public</span> <span class="k">as</span> <span class="nn">d3</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="c1"># Simulation units</span>
<span class="n">meter</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">6.37122e6</span>
<span class="n">hour</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">second</span> <span class="o">=</span> <span class="n">hour</span> <span class="o">/</span> <span class="mi">3600</span>

<span class="c1"># Parameters</span>
<span class="n">Nphi</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">Ntheta</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">dealias</span> <span class="o">=</span> <span class="mi">3</span><span class="o">/</span><span class="mi">2</span>
<span class="n">R</span> <span class="o">=</span> <span class="mf">6.37122e6</span> <span class="o">*</span> <span class="n">meter</span>
<span class="n">Omega</span> <span class="o">=</span> <span class="mf">7.292e-5</span> <span class="o">/</span> <span class="n">second</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">1e5</span> <span class="o">*</span> <span class="n">meter</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">second</span> <span class="o">/</span> <span class="mi">32</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># Hyperdiffusion matched at ell=32</span>
<span class="n">g</span> <span class="o">=</span> <span class="mf">9.80616</span> <span class="o">*</span> <span class="n">meter</span> <span class="o">/</span> <span class="n">second</span><span class="o">**</span><span class="mi">2</span>
<span class="n">H</span> <span class="o">=</span> <span class="mf">1e4</span> <span class="o">*</span> <span class="n">meter</span>
<span class="n">timestep</span> <span class="o">=</span> <span class="mi">600</span> <span class="o">*</span> <span class="n">second</span>
<span class="n">stop_sim_time</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">*</span> <span class="n">hour</span>
<span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>

<span class="c1"># Bases</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">S2Coordinates</span><span class="p">(</span><span class="s1">&#39;phi&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">)</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">Distributor</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">SphereBasis</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="p">(</span><span class="n">Nphi</span><span class="p">,</span> <span class="n">Ntheta</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="n">R</span><span class="p">,</span> <span class="n">dealias</span><span class="o">=</span><span class="n">dealias</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

<span class="c1"># Fields</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">VectorField</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="n">bases</span><span class="o">=</span><span class="n">basis</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">bases</span><span class="o">=</span><span class="n">basis</span><span class="p">)</span>

<span class="c1"># Substitutions</span>
<span class="n">zcross</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">A</span><span class="p">:</span> <span class="n">d3</span><span class="o">.</span><span class="n">MulCosine</span><span class="p">(</span><span class="n">d3</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>

<span class="c1"># Initial conditions: zonal jet</span>
<span class="n">phi</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">local_grids</span><span class="p">(</span><span class="n">basis</span><span class="p">)</span>
<span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">theta</span> <span class="o">+</span> <span class="mi">0</span><span class="o">*</span><span class="n">phi</span>
<span class="n">umax</span> <span class="o">=</span> <span class="mi">80</span> <span class="o">*</span> <span class="n">meter</span> <span class="o">/</span> <span class="n">second</span>
<span class="n">lat0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">lat1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">lat0</span>
<span class="n">en</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="n">lat1</span> <span class="o">-</span> <span class="n">lat0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">jet</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat0</span> <span class="o">&lt;=</span> <span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;=</span> <span class="n">lat1</span><span class="p">)</span>
<span class="n">u_jet</span> <span class="o">=</span> <span class="n">umax</span> <span class="o">/</span> <span class="n">en</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">lat</span><span class="p">[</span><span class="n">jet</span><span class="p">]</span> <span class="o">-</span> <span class="n">lat0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">lat</span><span class="p">[</span><span class="n">jet</span><span class="p">]</span> <span class="o">-</span> <span class="n">lat1</span><span class="p">))</span>
<span class="n">u</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">jet</span><span class="p">]</span>  <span class="o">=</span> <span class="n">u_jet</span>

<span class="c1"># Initial conditions: balanced height</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">LBVP</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="n">namespace</span><span class="o">=</span><span class="nb">locals</span><span class="p">())</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;g*lap(h) + c = - div(dot(u, grad(u)) + 2*Omega*zcross(u))&quot;</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;ave(h) = 0&quot;</span><span class="p">)</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">build_solver</span><span class="p">()</span>
<span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

<span class="c1"># Initial conditions: perturbation</span>
<span class="n">lat2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">hpert</span> <span class="o">=</span> <span class="mi">120</span> <span class="o">*</span> <span class="n">meter</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">15</span>
<span class="n">h</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">hpert</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">phi</span><span class="o">/</span><span class="n">alpha</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">lat2</span><span class="o">-</span><span class="n">lat</span><span class="p">)</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Problem</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">IVP</span><span class="p">([</span><span class="n">u</span><span class="p">,</span> <span class="n">h</span><span class="p">],</span> <span class="n">namespace</span><span class="o">=</span><span class="nb">locals</span><span class="p">())</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;dt(u) + nu*lap(lap(u)) + g*grad(h) + 2*Omega*zcross(u) = - dot(u, grad(u))&quot;</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;dt(h) + nu*lap(lap(h)) + H*div(u) = - div(h*u)&quot;</span><span class="p">)</span>


<span class="c1"># Solver</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">build_solver</span><span class="p">(</span><span class="n">d3</span><span class="o">.</span><span class="n">RK222</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">stop_sim_time</span> <span class="o">=</span> <span class="n">stop_sim_time</span>

<span class="c1"># Analysis</span>
<span class="n">snapshots</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">add_file_handler</span><span class="p">(</span><span class="s1">&#39;snapshots&#39;</span><span class="p">,</span> <span class="n">sim_dt</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">hour</span><span class="p">,</span> <span class="n">max_writes</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">snapshots</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">)</span>
<span class="n">snapshots</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="o">-</span><span class="n">d3</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">d3</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">u</span><span class="p">)),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;vorticity&#39;</span><span class="p">)</span>

<span class="c1"># Main loop</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting main loop&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">solver</span><span class="o">.</span><span class="n">proceed</span><span class="p">:</span>
        <span class="n">solver</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">iteration</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Iteration=</span><span class="si">%i</span><span class="s1">, Time=</span><span class="si">%e</span><span class="s1">, dt=</span><span class="si">%e</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">iteration</span><span class="p">,</span> <span class="n">solver</span><span class="o">.</span><span class="n">sim_time</span><span class="p">,</span> <span class="n">timestep</span><span class="p">))</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Exception raised, triggering end of main loop.&#39;</span><span class="p">)</span>
    <span class="k">raise</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">solver</span><span class="o">.</span><span class="n">log_stats</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Input</span> <span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span><span class="sd"> Dedalus script simulating the viscous shallow water equations on a sphere. This</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span><span class="sd"> script demonstrates solving an initial value problem on the sphere. It can be</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span><span class="sd">     $ mpiexec -n 4 python3 plot_sphere.py snapshots/*.h5</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="ne">---&gt; </span><span class="mi">19</span> <span class="kn">import</span> <span class="nn">dedalus.public</span> <span class="k">as</span> <span class="nn">d3</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="kn">import</span> <span class="nn">logging</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;dedalus&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Dedalus script simulating the viscous shallow water equations on a sphere. This</span>
<span class="sd">script demonstrates solving an initial value problem on the sphere. It can be</span>
<span class="sd">ran serially or in parallel, and uses the built-in analysis framework to save</span>
<span class="sd">data snapshots to HDF5 files. The `plot_sphere.py` script can be used to produce</span>
<span class="sd">plots from the saved data. The simulation should a few cpu-minutes to run.</span>

<span class="sd">The script implements the test case of a barotropically unstable mid-latitude</span>
<span class="sd">jet from Galewsky et al. 2004 (https://doi.org/10.3402/tellusa.v56i5.14436).</span>
<span class="sd">The initial height field balanced the imposed jet is solved with an LBVP.</span>
<span class="sd">A perturbation is then added and the solution is evolved as an IVP.</span>

<span class="sd">To run and plot using e.g. 4 processes:</span>
<span class="sd">    $ mpiexec -n 4 python3 shallow_water.py</span>
<span class="sd">    $ mpiexec -n 4 python3 plot_sphere.py snapshots/*.h5</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">dedalus.public</span> <span class="k">as</span> <span class="nn">d3</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="c1"># Simulation units</span>
<span class="n">meter</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">6.37122e6</span>
<span class="n">hour</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">second</span> <span class="o">=</span> <span class="n">hour</span> <span class="o">/</span> <span class="mi">3600</span>

<span class="c1"># Parameters</span>
<span class="n">Nphi</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">Ntheta</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">dealias</span> <span class="o">=</span> <span class="mi">3</span><span class="o">/</span><span class="mi">2</span>
<span class="n">R</span> <span class="o">=</span> <span class="mf">6.37122e6</span> <span class="o">*</span> <span class="n">meter</span>
<span class="n">Omega</span> <span class="o">=</span> <span class="mf">7.292e-5</span> <span class="o">/</span> <span class="n">second</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">1e5</span> <span class="o">*</span> <span class="n">meter</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">second</span> <span class="o">/</span> <span class="mi">32</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># Hyperdiffusion matched at ell=32</span>
<span class="n">g</span> <span class="o">=</span> <span class="mf">9.80616</span> <span class="o">*</span> <span class="n">meter</span> <span class="o">/</span> <span class="n">second</span><span class="o">**</span><span class="mi">2</span>
<span class="n">H</span> <span class="o">=</span> <span class="mf">1e4</span> <span class="o">*</span> <span class="n">meter</span>
<span class="n">timestep</span> <span class="o">=</span> <span class="mi">600</span> <span class="o">*</span> <span class="n">second</span>
<span class="n">stop_sim_time</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">*</span> <span class="n">hour</span>
<span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>

<span class="c1"># Bases</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">S2Coordinates</span><span class="p">(</span><span class="s1">&#39;phi&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">)</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">Distributor</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">SphereBasis</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="p">(</span><span class="n">Nphi</span><span class="p">,</span> <span class="n">Ntheta</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="n">R</span><span class="p">,</span> <span class="n">dealias</span><span class="o">=</span><span class="n">dealias</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

<span class="c1"># Fields</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">VectorField</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="n">bases</span><span class="o">=</span><span class="n">basis</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">bases</span><span class="o">=</span><span class="n">basis</span><span class="p">)</span>
<span class="n">tan_theta</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;tan_theta&#39;</span><span class="p">,</span> <span class="n">bases</span><span class="o">=</span><span class="n">basis</span><span class="p">)</span>
<span class="n">zonal_unit</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">VectorField</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;zonal_unit&#39;</span><span class="p">,</span> <span class="n">bases</span><span class="o">=</span><span class="n">basis</span><span class="p">)</span>

<span class="c1"># Substitutions</span>
<span class="n">zcross</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">A</span><span class="p">:</span> <span class="n">d3</span><span class="o">.</span><span class="n">MulCosine</span><span class="p">(</span><span class="n">d3</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>
<span class="c1">#tan    = np.tan(lat)</span>

<span class="c1"># Initial conditions: zonal jet</span>
<span class="n">phi</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">local_grids</span><span class="p">(</span><span class="n">basis</span><span class="p">)</span>
<span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">theta</span> <span class="o">+</span> <span class="mi">0</span><span class="o">*</span><span class="n">phi</span>
<span class="n">umax</span> <span class="o">=</span> <span class="mi">80</span> <span class="o">*</span> <span class="n">meter</span> <span class="o">/</span> <span class="n">second</span>
<span class="n">lat0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">lat1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">lat0</span>
<span class="n">en</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="n">lat1</span> <span class="o">-</span> <span class="n">lat0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">jet</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat0</span> <span class="o">&lt;=</span> <span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;=</span> <span class="n">lat1</span><span class="p">)</span>
<span class="n">u_jet</span> <span class="o">=</span> <span class="n">umax</span> <span class="o">/</span> <span class="n">en</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">lat</span><span class="p">[</span><span class="n">jet</span><span class="p">]</span> <span class="o">-</span> <span class="n">lat0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">lat</span><span class="p">[</span><span class="n">jet</span><span class="p">]</span> <span class="o">-</span> <span class="n">lat1</span><span class="p">))</span>
<span class="n">u</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">jet</span><span class="p">]</span>  <span class="o">=</span> <span class="n">u_jet</span>
<span class="n">tan_theta</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
<span class="n">zonal_unit</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">zonal_unit</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Initial conditions: balanced height</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">LBVP</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="n">namespace</span><span class="o">=</span><span class="nb">locals</span><span class="p">())</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;g*lap(h) + c = - div(dot(u, grad(u)) + 2*Omega*zcross(u))&quot;</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;ave(h) = 0&quot;</span><span class="p">)</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">build_solver</span><span class="p">()</span>
<span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

<span class="c1"># Initial conditions: perturbation</span>
<span class="n">lat2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">hpert</span> <span class="o">=</span> <span class="mi">120</span> <span class="o">*</span> <span class="n">meter</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">15</span>
<span class="n">h</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">hpert</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">phi</span><span class="o">/</span><span class="n">alpha</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">lat2</span><span class="o">-</span><span class="n">lat</span><span class="p">)</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Problem</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">IVP</span><span class="p">([</span><span class="n">u</span><span class="p">,</span> <span class="n">h</span><span class="p">],</span> <span class="n">namespace</span><span class="o">=</span><span class="nb">locals</span><span class="p">())</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;dt(u) + nu*lap(lap(u)) + g*grad(h) + 2*Omega*zcross(u) = - dot(u, grad(u))&quot;</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;dt(h) + nu*lap(lap(h)) + H*div(u) = - div(h*u)&quot;</span><span class="p">)</span>

<span class="c1"># Solver</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">build_solver</span><span class="p">(</span><span class="n">d3</span><span class="o">.</span><span class="n">RK222</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">stop_sim_time</span> <span class="o">=</span> <span class="n">stop_sim_time</span>

<span class="c1"># Analysis</span>
<span class="n">snapshots</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">add_file_handler</span><span class="p">(</span><span class="s1">&#39;snapshots&#39;</span><span class="p">,</span> <span class="n">sim_dt</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">hour</span><span class="p">,</span> <span class="n">max_writes</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">snapshots</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">)</span>
<span class="n">snapshots</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="o">-</span><span class="n">d3</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">d3</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">u</span><span class="p">)),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;vorticity&#39;</span><span class="p">)</span>

<span class="c1"># Main loop</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting main loop&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">solver</span><span class="o">.</span><span class="n">proceed</span><span class="p">:</span>
        <span class="n">solver</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">iteration</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Iteration=</span><span class="si">%i</span><span class="s1">, Time=</span><span class="si">%e</span><span class="s1">, dt=</span><span class="si">%e</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">iteration</span><span class="p">,</span> <span class="n">solver</span><span class="o">.</span><span class="n">sim_time</span><span class="p">,</span> <span class="n">timestep</span><span class="p">))</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Exception raised, triggering end of main loop.&#39;</span><span class="p">)</span>
    <span class="k">raise</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">solver</span><span class="o">.</span><span class="n">log_stats</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-1-29fc9d3aa0ab&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> 
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="ne">---&gt; </span><span class="mi">19</span> <span class="kn">import</span> <span class="nn">dedalus.public</span> <span class="k">as</span> <span class="nn">d3</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="kn">import</span> <span class="nn">logging</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;dedalus&#39;

<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NOTE</span>: If your import is failing due to a missing package, you can
<span class="n">manually</span> <span class="n">install</span> <span class="n">dependencies</span> <span class="n">using</span> <span class="n">either</span> <span class="o">!</span>pip or !apt.

<span class="n">To</span> <span class="n">view</span> <span class="n">examples</span> <span class="n">of</span> <span class="n">installing</span> <span class="n">some</span> <span class="n">common</span> <span class="n">dependencies</span><span class="p">,</span> <span class="n">click</span> <span class="n">the</span>
<span class="s2">&quot;Open Examples&quot;</span> <span class="n">button</span> <span class="n">below</span><span class="o">.</span>
<span class="gt">---------------------------------------------------------------------------</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zonal_unit</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">VectorField</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;zonal_unit&#39;</span><span class="p">,</span> <span class="n">bases</span><span class="o">=</span><span class="n">basis</span><span class="p">)</span>
<span class="n">zonal_unit</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">zonal_unit</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">((</span><span class="n">zonal_unit</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()[</span><span class="s1">&#39;g&#39;</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">((</span><span class="n">d3</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">zonal_unit</span><span class="p">,</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">d3</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()[</span><span class="s1">&#39;g&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2, 384, 192)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 1: Install FFTW</span>
<span class="o">!</span>apt-get install libfftw3-dev
<span class="o">!</span>apt-get install libfftw3-mpi-dev

<span class="c1"># Step 2: Set paths for Dedalus installation</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MPI_INCLUDE_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/usr/lib/x86_64-linux-gnu/openmpi/include&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MPI_LIBRARY_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/usr/lib/x86_64-linux-gnu&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;FFTW_INCLUDE_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/usr/include&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;FFTW_LIBRARY_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/usr/lib/x86_64-linux-gnu&quot;</span>

<span class="c1"># Step 3: Install Dedalus using pip</span>
<span class="o">!</span>pip3 install --no-cache http://github.com/dedalusproject/dedalus/zipball/d3/
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following packages were automatically installed and are no longer required:
  libnvidia-common-460 nsight-compute-2020.2.0
Use &#39;apt autoremove&#39; to remove them.
The following additional packages will be installed:
  libfftw3-bin libfftw3-long3 libfftw3-quad3 libfftw3-single3
Suggested packages:
  libfftw3-doc
The following NEW packages will be installed:
  libfftw3-bin libfftw3-dev libfftw3-long3 libfftw3-quad3 libfftw3-single3
0 upgraded, 5 newly installed, 0 to remove and 42 not upgraded.
Need to get 3,766 kB of archives.
After this operation, 21.2 MB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu bionic/main amd64 libfftw3-long3 amd64 3.3.7-1 [308 kB]
Get:2 http://archive.ubuntu.com/ubuntu bionic/main amd64 libfftw3-quad3 amd64 3.3.7-1 [552 kB]
Get:3 http://archive.ubuntu.com/ubuntu bionic/main amd64 libfftw3-single3 amd64 3.3.7-1 [764 kB]
Get:4 http://archive.ubuntu.com/ubuntu bionic/main amd64 libfftw3-bin amd64 3.3.7-1 [32.7 kB]
Get:5 http://archive.ubuntu.com/ubuntu bionic/main amd64 libfftw3-dev amd64 3.3.7-1 [2,108 kB]
Fetched 3,766 kB in 0s (22.8 MB/s)
Selecting previously unselected package libfftw3-long3:amd64.
(Reading database ... 155202 files and directories currently installed.)
Preparing to unpack .../libfftw3-long3_3.3.7-1_amd64.deb ...
Unpacking libfftw3-long3:amd64 (3.3.7-1) ...
Selecting previously unselected package libfftw3-quad3:amd64.
Preparing to unpack .../libfftw3-quad3_3.3.7-1_amd64.deb ...
Unpacking libfftw3-quad3:amd64 (3.3.7-1) ...
Selecting previously unselected package libfftw3-single3:amd64.
Preparing to unpack .../libfftw3-single3_3.3.7-1_amd64.deb ...
Unpacking libfftw3-single3:amd64 (3.3.7-1) ...
Selecting previously unselected package libfftw3-bin.
Preparing to unpack .../libfftw3-bin_3.3.7-1_amd64.deb ...
Unpacking libfftw3-bin (3.3.7-1) ...
Selecting previously unselected package libfftw3-dev:amd64.
Preparing to unpack .../libfftw3-dev_3.3.7-1_amd64.deb ...
Unpacking libfftw3-dev:amd64 (3.3.7-1) ...
Setting up libfftw3-quad3:amd64 (3.3.7-1) ...
Setting up libfftw3-single3:amd64 (3.3.7-1) ...
Setting up libfftw3-long3:amd64 (3.3.7-1) ...
Setting up libfftw3-bin (3.3.7-1) ...
Setting up libfftw3-dev:amd64 (3.3.7-1) ...
Processing triggers for libc-bin (2.27-3ubuntu1.3) ...
/sbin/ldconfig.real: /usr/local/lib/python3.7/dist-packages/ideep4py/lib/libmkldnn.so.0 is not a symbolic link

Processing triggers for man-db (2.8.3-2ubuntu0.1) ...
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following packages were automatically installed and are no longer required:
  libnvidia-common-460 nsight-compute-2020.2.0
Use &#39;apt autoremove&#39; to remove them.
The following additional packages will be installed:
  libfftw3-mpi3
Suggested packages:
  libfftw3-doc
The following NEW packages will be installed:
  libfftw3-mpi-dev libfftw3-mpi3
0 upgraded, 2 newly installed, 0 to remove and 42 not upgraded.
Need to get 95.1 kB of archives.
After this operation, 941 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libfftw3-mpi3 amd64 3.3.7-1 [47.5 kB]
Get:2 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libfftw3-mpi-dev amd64 3.3.7-1 [47.6 kB]
Fetched 95.1 kB in 0s (1,290 kB/s)
Selecting previously unselected package libfftw3-mpi3:amd64.
(Reading database ... 155293 files and directories currently installed.)
Preparing to unpack .../libfftw3-mpi3_3.3.7-1_amd64.deb ...
Unpacking libfftw3-mpi3:amd64 (3.3.7-1) ...
Selecting previously unselected package libfftw3-mpi-dev:amd64.
Preparing to unpack .../libfftw3-mpi-dev_3.3.7-1_amd64.deb ...
Unpacking libfftw3-mpi-dev:amd64 (3.3.7-1) ...
Setting up libfftw3-mpi3:amd64 (3.3.7-1) ...
Setting up libfftw3-mpi-dev:amd64 (3.3.7-1) ...
Processing triggers for libc-bin (2.27-3ubuntu1.3) ...
/sbin/ldconfig.real: /usr/local/lib/python3.7/dist-packages/ideep4py/lib/libmkldnn.so.0 is not a symbolic link

Collecting http://github.com/dedalusproject/dedalus/zipball/d3/
  Downloading http://github.com/dedalusproject/dedalus/zipball/d3/
     \ 23.3 MB 1.9 MB/s
?25h  Installing build dependencies ... ?25l?25hdone
  Getting requirements to build wheel ... ?25l?25hdone
    Preparing wheel metadata ... ?25l?25hdone
Collecting mpi4py&gt;=2.0.0
  Downloading mpi4py-3.1.3.tar.gz (2.5 MB)
     || 2.5 MB 27.5 MB/s 
?25h  Installing build dependencies ... ?25l?25hdone
  Getting requirements to build wheel ... ?25l?25hdone
    Preparing wheel metadata ... ?25l?25hdone
Requirement already satisfied: pytest in /usr/local/lib/python3.7/dist-packages (from dedalus==3.0.0a0) (3.6.4)
Requirement already satisfied: matplotlib in /usr/local/lib/python3.7/dist-packages (from dedalus==3.0.0a0) (3.2.2)
Requirement already satisfied: docopt in /usr/local/lib/python3.7/dist-packages (from dedalus==3.0.0a0) (0.6.2)
Requirement already satisfied: numpy&gt;=1.20.0 in /usr/local/lib/python3.7/dist-packages (from dedalus==3.0.0a0) (1.21.6)
Collecting pytest-benchmark
  Downloading pytest_benchmark-3.4.1-py2.py3-none-any.whl (50 kB)
     || 50 kB 63.4 MB/s 
?25hRequirement already satisfied: h5py&gt;=2.6.0 in /usr/local/lib/python3.7/dist-packages (from dedalus==3.0.0a0) (3.1.0)
Requirement already satisfied: scipy&gt;=1.4.0 in /usr/local/lib/python3.7/dist-packages (from dedalus==3.0.0a0) (1.4.1)
Collecting pytest-parallel
  Downloading pytest_parallel-0.1.1-py3-none-any.whl (7.0 kB)
Collecting pytest-cov
  Downloading pytest_cov-3.0.0-py3-none-any.whl (20 kB)
Requirement already satisfied: numexpr in /usr/local/lib/python3.7/dist-packages (from dedalus==3.0.0a0) (2.8.1)
Requirement already satisfied: cached-property in /usr/local/lib/python3.7/dist-packages (from h5py&gt;=2.6.0-&gt;dedalus==3.0.0a0) (1.5.2)
Requirement already satisfied: python-dateutil&gt;=2.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;dedalus==3.0.0a0) (2.8.2)
Requirement already satisfied: cycler&gt;=0.10 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;dedalus==3.0.0a0) (0.11.0)
Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,&gt;=2.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;dedalus==3.0.0a0) (3.0.8)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;dedalus==3.0.0a0) (1.4.2)
Requirement already satisfied: typing-extensions in /usr/local/lib/python3.7/dist-packages (from kiwisolver&gt;=1.0.1-&gt;matplotlib-&gt;dedalus==3.0.0a0) (4.2.0)
Requirement already satisfied: six&gt;=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil&gt;=2.1-&gt;matplotlib-&gt;dedalus==3.0.0a0) (1.15.0)
Requirement already satisfied: packaging in /usr/local/lib/python3.7/dist-packages (from numexpr-&gt;dedalus==3.0.0a0) (21.3)
Requirement already satisfied: py&gt;=1.5.0 in /usr/local/lib/python3.7/dist-packages (from pytest-&gt;dedalus==3.0.0a0) (1.11.0)
Requirement already satisfied: more-itertools&gt;=4.0.0 in /usr/local/lib/python3.7/dist-packages (from pytest-&gt;dedalus==3.0.0a0) (8.12.0)
Requirement already satisfied: pluggy&lt;0.8,&gt;=0.5 in /usr/local/lib/python3.7/dist-packages (from pytest-&gt;dedalus==3.0.0a0) (0.7.1)
Requirement already satisfied: atomicwrites&gt;=1.0 in /usr/local/lib/python3.7/dist-packages (from pytest-&gt;dedalus==3.0.0a0) (1.4.0)
Requirement already satisfied: attrs&gt;=17.4.0 in /usr/local/lib/python3.7/dist-packages (from pytest-&gt;dedalus==3.0.0a0) (21.4.0)
Requirement already satisfied: setuptools in /usr/local/lib/python3.7/dist-packages (from pytest-&gt;dedalus==3.0.0a0) (57.4.0)
Collecting py-cpuinfo
  Downloading py-cpuinfo-8.0.0.tar.gz (99 kB)
     || 99 kB 85.5 MB/s 
?25hCollecting pytest
  Downloading pytest-7.1.2-py3-none-any.whl (297 kB)
     || 297 kB 77.5 MB/s 
?25hRequirement already satisfied: importlib-metadata&gt;=0.12 in /usr/local/lib/python3.7/dist-packages (from pytest-&gt;dedalus==3.0.0a0) (4.11.3)
  Downloading pytest-7.1.1-py3-none-any.whl (297 kB)
     || 297 kB 72.7 MB/s 
?25h  Downloading pytest-7.1.0-py3-none-any.whl (297 kB)
     || 297 kB 86.5 MB/s 
?25h  Downloading pytest-7.0.1-py3-none-any.whl (296 kB)
     || 296 kB 87.7 MB/s 
?25h  Downloading pytest-7.0.0-py3-none-any.whl (296 kB)
     || 296 kB 88.4 MB/s 
?25h  Downloading pytest-6.2.5-py3-none-any.whl (280 kB)
     || 280 kB 88.9 MB/s 
?25h  Downloading pytest-6.2.4-py3-none-any.whl (280 kB)
     || 280 kB 85.5 MB/s 
?25h  Downloading pytest-6.2.3-py3-none-any.whl (280 kB)
     || 280 kB 89.0 MB/s 
?25h  Downloading pytest-6.2.2-py3-none-any.whl (280 kB)
     || 280 kB 83.7 MB/s 
?25h  Downloading pytest-6.2.1-py3-none-any.whl (279 kB)
     || 279 kB 83.7 MB/s 
?25h  Downloading pytest-6.2.0-py3-none-any.whl (279 kB)
     || 279 kB 85.2 MB/s 
?25h  Downloading pytest-6.1.2-py3-none-any.whl (272 kB)
     || 272 kB 77.5 MB/s 
?25hCollecting toml
  Downloading toml-0.10.2-py2.py3-none-any.whl (16 kB)
Requirement already satisfied: iniconfig in /usr/local/lib/python3.7/dist-packages (from pytest-&gt;dedalus==3.0.0a0) (1.1.1)
Collecting pytest
  Downloading pytest-6.1.1-py3-none-any.whl (272 kB)
     || 272 kB 63.2 MB/s 
?25h  Downloading pytest-6.1.0-py3-none-any.whl (272 kB)
     || 272 kB 87.1 MB/s 
?25h  Downloading pytest-6.0.2-py3-none-any.whl (270 kB)
     || 270 kB 83.1 MB/s 
?25h  Downloading pytest-6.0.1-py3-none-any.whl (270 kB)
     || 270 kB 88.0 MB/s 
?25h  Downloading pytest-6.0.0-py3-none-any.whl (270 kB)
     || 270 kB 87.9 MB/s 
?25h  Downloading pytest-5.4.3-py3-none-any.whl (248 kB)
     || 248 kB 96.2 MB/s 
?25h  Downloading pytest-5.4.2-py3-none-any.whl (247 kB)
     || 247 kB 72.9 MB/s 
?25h  Downloading pytest-5.4.1-py3-none-any.whl (246 kB)
     || 246 kB 89.8 MB/s 
?25h  Downloading pytest-5.4.0-py3-none-any.whl (247 kB)
     || 247 kB 86.9 MB/s 
?25h  Downloading pytest-5.3.5-py3-none-any.whl (235 kB)
     || 235 kB 89.4 MB/s 
?25h  Downloading pytest-5.3.4-py3-none-any.whl (235 kB)
     || 235 kB 89.4 MB/s 
?25h  Downloading pytest-5.3.3-py3-none-any.whl (235 kB)
     || 235 kB 81.7 MB/s 
?25h  Downloading pytest-5.3.2-py3-none-any.whl (234 kB)
     || 234 kB 92.1 MB/s 
?25h  Downloading pytest-5.3.1-py3-none-any.whl (233 kB)
     || 233 kB 85.9 MB/s 
?25h  Downloading pytest-5.3.0-py3-none-any.whl (233 kB)
     || 233 kB 69.4 MB/s 
?25h  Downloading pytest-5.2.4-py3-none-any.whl (227 kB)
     || 227 kB 89.0 MB/s 
?25h  Downloading pytest-5.2.3-py3-none-any.whl (227 kB)
     || 227 kB 69.4 MB/s 
?25h  Downloading pytest-5.2.2-py3-none-any.whl (227 kB)
     || 227 kB 84.7 MB/s 
?25h  Downloading pytest-5.2.1-py3-none-any.whl (226 kB)
     || 226 kB 91.3 MB/s 
?25h  Downloading pytest-5.2.0-py3-none-any.whl (226 kB)
     || 226 kB 91.4 MB/s 
?25h  Downloading pytest-5.1.3-py3-none-any.whl (224 kB)
     || 224 kB 72.6 MB/s 
?25h  Downloading pytest-5.1.2-py3-none-any.whl (224 kB)
     || 224 kB 85.9 MB/s 
?25h  Downloading pytest-5.1.1-py3-none-any.whl (223 kB)
     || 223 kB 80.8 MB/s 
?25h  Downloading pytest-5.1.0-py3-none-any.whl (223 kB)
     || 223 kB 66.9 MB/s 
?25h  Downloading pytest-5.0.1-py3-none-any.whl (221 kB)
     || 221 kB 68.5 MB/s 
?25h  Downloading pytest-5.0.0-py3-none-any.whl (221 kB)
     || 221 kB 61.5 MB/s 
?25h  Downloading pytest-4.6.11-py2.py3-none-any.whl (231 kB)
     || 231 kB 61.8 MB/s 
?25h  Downloading pytest-4.6.10-py2.py3-none-any.whl (231 kB)
     || 231 kB 84.0 MB/s 
?25h  Downloading pytest-4.6.9-py2.py3-none-any.whl (231 kB)
     || 231 kB 88.8 MB/s 
?25h  Downloading pytest-4.6.8-py2.py3-none-any.whl (230 kB)
     || 230 kB 83.4 MB/s 
?25h  Downloading pytest-4.6.7-py2.py3-none-any.whl (230 kB)
     || 230 kB 89.1 MB/s 
?25h  Downloading pytest-4.6.6-py2.py3-none-any.whl (230 kB)
     || 230 kB 81.2 MB/s 
?25h  Downloading pytest-4.6.5-py2.py3-none-any.whl (230 kB)
     || 230 kB 92.7 MB/s 
?25h  Downloading pytest-4.6.4-py2.py3-none-any.whl (229 kB)
     || 229 kB 87.7 MB/s 
?25h  Downloading pytest-4.6.3-py2.py3-none-any.whl (229 kB)
     || 229 kB 76.1 MB/s 
?25h  Downloading pytest-4.6.2-py2.py3-none-any.whl (229 kB)
     || 229 kB 69.7 MB/s 
?25h  Downloading pytest-4.6.1-py2.py3-none-any.whl (229 kB)
     || 229 kB 90.9 MB/s 
?25h  Downloading pytest-4.6.0-py2.py3-none-any.whl (229 kB)
     || 229 kB 86.0 MB/s 
?25h  Downloading pytest-4.5.0-py2.py3-none-any.whl (227 kB)
     || 227 kB 85.6 MB/s 
?25h  Downloading pytest-4.4.2-py2.py3-none-any.whl (224 kB)
     || 224 kB 67.7 MB/s 
?25h  Downloading pytest-4.4.1-py2.py3-none-any.whl (223 kB)
     || 223 kB 88.5 MB/s 
?25h  Downloading pytest-4.4.0-py2.py3-none-any.whl (223 kB)
     || 223 kB 94.9 MB/s 
?25h  Downloading pytest-4.3.1-py2.py3-none-any.whl (219 kB)
     || 219 kB 93.9 MB/s 
?25hCollecting coverage[toml]&gt;=5.2.1
  Downloading coverage-6.3.2-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (207 kB)
     || 207 kB 71.0 MB/s 
?25hRequirement already satisfied: tomli in /usr/local/lib/python3.7/dist-packages (from coverage[toml]&gt;=5.2.1-&gt;pytest-cov-&gt;dedalus==3.0.0a0) (2.0.1)
INFO: pip is looking at multiple versions of coverage to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of coverage[toml] to determine which version is compatible with other requirements. This could take a while.
  Downloading coverage-6.3.1-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (207 kB)
     || 207 kB 86.0 MB/s 
?25h  Downloading coverage-6.3-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (207 kB)
     || 207 kB 89.9 MB/s 
?25h  Downloading coverage-6.2-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (213 kB)
     || 213 kB 85.3 MB/s 
?25h  Downloading coverage-6.1.2-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (213 kB)
     || 213 kB 90.1 MB/s 
?25h  Downloading coverage-6.1.1-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (213 kB)
     || 213 kB 84.8 MB/s 
?25h  Downloading coverage-6.1-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (213 kB)
     || 213 kB 69.6 MB/s 
?25h  Downloading coverage-6.0.2-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (253 kB)
     || 253 kB 82.3 MB/s 
?25hINFO: pip is looking at multiple versions of coverage to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of coverage[toml] to determine which version is compatible with other requirements. This could take a while.
  Downloading coverage-6.0.1-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (252 kB)
     || 252 kB 88.7 MB/s 
?25h  Downloading coverage-6.0-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (252 kB)
     || 252 kB 82.6 MB/s 
?25h  Downloading coverage-5.5-cp37-cp37m-manylinux2010_x86_64.whl (242 kB)
     || 242 kB 88.3 MB/s 
?25h  Downloading coverage-5.4-cp37-cp37m-manylinux2010_x86_64.whl (242 kB)
     || 242 kB 87.1 MB/s 
?25h  Downloading coverage-5.3.1-cp37-cp37m-manylinux2010_x86_64.whl (242 kB)
     || 242 kB 85.4 MB/s 
?25hINFO: This is taking longer than usual. You might need to provide the dependency resolver with stricter constraints to reduce runtime. If you want to abort this run, you can press Ctrl + C to do so. To improve how pip performs, tell us what happened here: https://pip.pypa.io/surveys/backtracking
INFO: This is taking longer than usual. You might need to provide the dependency resolver with stricter constraints to reduce runtime. If you want to abort this run, you can press Ctrl + C to do so. To improve how pip performs, tell us what happened here: https://pip.pypa.io/surveys/backtracking
  Downloading coverage-5.3-cp37-cp37m-manylinux1_x86_64.whl (229 kB)
     || 229 kB 81.1 MB/s 
?25h  Downloading coverage-5.2.1-cp37-cp37m-manylinux1_x86_64.whl (229 kB)
     || 229 kB 84.1 MB/s 
?25hINFO: pip is looking at multiple versions of pytest-cov to determine which version is compatible with other requirements. This could take a while.
Collecting pytest-cov
  Downloading pytest_cov-2.12.1-py2.py3-none-any.whl (20 kB)
  Downloading pytest_cov-2.12.0-py2.py3-none-any.whl (20 kB)
  Downloading pytest_cov-2.11.1-py2.py3-none-any.whl (20 kB)
  Downloading pytest_cov-2.11.0-py2.py3-none-any.whl (20 kB)
  Downloading pytest_cov-2.10.1-py2.py3-none-any.whl (19 kB)
Collecting coverage&gt;=4.4
<span class=" -Color -Color-Yellow">  WARNING: Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by &#39;ProtocolError(&#39;Connection aborted.&#39;, ConnectionResetError(104, &#39;Connection reset by peer&#39;))&#39;: /packages/dd/ee/2cc12177fe77d116d5a0c5e7c2fb2c1f5f3d5dd287e8bb67a17948684ede/coverage-5.2-cp37-cp37m-manylinux1_x86_64.whl</span>
  Downloading coverage-5.2-cp37-cp37m-manylinux1_x86_64.whl (229 kB)
     || 229 kB 27.0 MB/s 
?25h  Downloading coverage-5.1-cp37-cp37m-manylinux1_x86_64.whl (227 kB)
     || 227 kB 48.6 MB/s 
?25h  Downloading coverage-5.0.4-cp37-cp37m-manylinux1_x86_64.whl (227 kB)
     || 227 kB 83.7 MB/s 
?25h  Downloading coverage-5.0.3-cp37-cp37m-manylinux1_x86_64.whl (227 kB)
     || 227 kB 79.8 MB/s 
?25h  Downloading coverage-5.0.2-cp37-cp37m-manylinux1_x86_64.whl (226 kB)
     || 226 kB 85.3 MB/s 
?25h  Downloading coverage-5.0.1-cp37-cp37m-manylinux1_x86_64.whl (226 kB)
     || 226 kB 83.7 MB/s 
?25h  Downloading coverage-5.0-cp37-cp37m-manylinux1_x86_64.whl (226 kB)
     || 226 kB 82.3 MB/s 
?25h  Downloading coverage-4.5.4-cp37-cp37m-manylinux1_x86_64.whl (205 kB)
     || 205 kB 77.3 MB/s 
?25h  Downloading coverage-4.5.3-cp37-cp37m-manylinux1_x86_64.whl (204 kB)
     || 204 kB 89.6 MB/s 
?25h  Downloading coverage-4.5.2-cp37-cp37m-manylinux1_x86_64.whl (205 kB)
     || 205 kB 81.5 MB/s 
?25h  Downloading coverage-4.5.1-cp37-cp37m-manylinux1_x86_64.whl (202 kB)
     || 202 kB 89.2 MB/s 
?25h  Downloading coverage-4.5.tar.gz (378 kB)
     || 378 kB 82.2 MB/s 
?25h  Downloading coverage-4.4.2.tar.gz (374 kB)
     || 374 kB 79.3 MB/s 
?25h  Downloading coverage-4.4.1.tar.gz (369 kB)
     || 369 kB 76.9 MB/s 
?25h  Downloading coverage-4.4.tar.gz (369 kB)
     || 369 kB 81.1 MB/s 
?25hCollecting pytest-cov
  Downloading pytest_cov-2.10.0-py2.py3-none-any.whl (19 kB)
  Downloading pytest_cov-2.9.0-py2.py3-none-any.whl (19 kB)
Requirement already satisfied: tblib in /usr/local/lib/python3.7/dist-packages (from pytest-parallel-&gt;dedalus==3.0.0a0) (1.7.0)
Building wheels for collected packages: dedalus, mpi4py, py-cpuinfo
  Building wheel for dedalus (PEP 517) ... ?25l?25hdone
  Created wheel for dedalus: filename=dedalus-3.0.0a0-cp37-cp37m-linux_x86_64.whl size=1600331 sha256=1cf6062aad43bc2c3aee857ab6676588ce503570f87bb60434e3e04a4b36aa78
  Stored in directory: /tmp/pip-ephem-wheel-cache-kwimx3zs/wheels/4f/9e/02/b9dedd82f504e0234fd1ef1b7f1888d3af12cf5bbb1d1eff5f
  Building wheel for mpi4py (PEP 517) ... ?25l?25hdone
  Created wheel for mpi4py: filename=mpi4py-3.1.3-cp37-cp37m-linux_x86_64.whl size=2185301 sha256=f9e68118fc3a0dab3737da18c22b2f2886ae580b0dae13f568b130ac408a1940
  Stored in directory: /tmp/pip-ephem-wheel-cache-kwimx3zs/wheels/7a/07/14/6a0c63fa2c6e473c6edc40985b7d89f05c61ff25ee7f0ad9ac
  Building wheel for py-cpuinfo (setup.py) ... ?25l?25hdone
  Created wheel for py-cpuinfo: filename=py_cpuinfo-8.0.0-py3-none-any.whl size=22257 sha256=104e2b326eea9f9aa968b16bd959e3d0ba299d02efaef7ecd7a09201404440e0
  Stored in directory: /tmp/pip-ephem-wheel-cache-kwimx3zs/wheels/d2/f1/1f/041add21dc9c4220157f1bd2bd6afe1f1a49524c3396b94401
Successfully built dedalus mpi4py py-cpuinfo
Installing collected packages: pytest, py-cpuinfo, coverage, pytest-parallel, pytest-cov, pytest-benchmark, mpi4py, dedalus
  Attempting uninstall: pytest
    Found existing installation: pytest 3.6.4
    Uninstalling pytest-3.6.4:
      Successfully uninstalled pytest-3.6.4
  Attempting uninstall: coverage
    Found existing installation: coverage 3.7.1
    Uninstalling coverage-3.7.1:
      Successfully uninstalled coverage-3.7.1
<span class=" -Color -Color-Red">ERROR: pip&#39;s dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.</span>
<span class=" -Color -Color-Red">datascience 0.10.6 requires coverage==3.7.1, but you have coverage 6.3.2 which is incompatible.</span>
<span class=" -Color -Color-Red">datascience 0.10.6 requires folium==0.2.1, but you have folium 0.8.3 which is incompatible.</span>
<span class=" -Color -Color-Red">coveralls 0.5 requires coverage&lt;3.999,&gt;=3.6, but you have coverage 6.3.2 which is incompatible.</span>
Successfully installed coverage-6.3.2 dedalus-3.0.0a0 mpi4py-3.1.3 py-cpuinfo-8.0.0 pytest-4.3.1 pytest-benchmark-3.4.1 pytest-cov-2.9.0 pytest-parallel-0.1.1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!mv /content/snapshots /content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots</span>
<span class="c1">#!pip uninstall dedalus</span>
<span class="o">!</span>pip3 install --no-cache http://github.com/dedalusproject/dedalus/zipball/d3/
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting http://github.com/dedalusproject/dedalus/zipball/d3/
  Downloading http://github.com/dedalusproject/dedalus/zipball/d3/
     - 23.3 MB 798 kB/s
?25h  Installing build dependencies ... ?25l?25hdone
  Getting requirements to build wheel ... ?25l?25herror
<span class=" -Color -Color-Yellow">WARNING: Discarding http://github.com/dedalusproject/dedalus/zipball/d3/. Command errored out with exit status 1: /usr/bin/python3 /usr/local/lib/python3.7/dist-packages/pip/_vendor/pep517/in_process/_in_process.py get_requires_for_build_wheel /tmp/tmpdclesyj7 Check the logs for full command output.</span>
<span class=" -Color -Color-Red">ERROR: Command errored out with exit status 1: /usr/bin/python3 /usr/local/lib/python3.7/dist-packages/pip/_vendor/pep517/in_process/_in_process.py get_requires_for_build_wheel /tmp/tmpdclesyj7 Check the logs for full command output.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for plotting </span>
<span class="o">!</span>pip install dedalus
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting dedalus
  Downloading dedalus-2.2006.tar.gz (123 kB)
?25l
     |                             | 10 kB 17.6 MB/s eta 0:00:01
     |                          | 20 kB 10.4 MB/s eta 0:00:01
     |                        | 30 kB 8.2 MB/s eta 0:00:01
     |                     | 40 kB 3.5 MB/s eta 0:00:01
     |                  | 51 kB 3.5 MB/s eta 0:00:01
     |                | 61 kB 4.2 MB/s eta 0:00:01
     |             | 71 kB 4.4 MB/s eta 0:00:01
     |          | 81 kB 4.4 MB/s eta 0:00:01
     |        | 92 kB 4.9 MB/s eta 0:00:01
     |     | 102 kB 4.1 MB/s eta 0:00:01
     |  | 112 kB 4.1 MB/s eta 0:00:01
     || 122 kB 4.1 MB/s eta 0:00:01
     || 123 kB 4.1 MB/s 
?25h  Installing build dependencies ... ?25l?25hdone
  Getting requirements to build wheel ... ?25l?25hdone
    Preparing wheel metadata ... ?25l?25hdone
Requirement already satisfied: matplotlib in /usr/local/lib/python3.7/dist-packages (from dedalus) (3.2.2)
Requirement already satisfied: pytest-cov in /usr/local/lib/python3.7/dist-packages (from dedalus) (2.9.0)
Requirement already satisfied: pytest-benchmark in /usr/local/lib/python3.7/dist-packages (from dedalus) (3.4.1)
Requirement already satisfied: h5py&gt;=2.10.0 in /usr/local/lib/python3.7/dist-packages (from dedalus) (3.1.0)
Requirement already satisfied: docopt in /usr/local/lib/python3.7/dist-packages (from dedalus) (0.6.2)
Requirement already satisfied: mpi4py&gt;=2.0.0 in /usr/local/lib/python3.7/dist-packages (from dedalus) (3.1.3)
Requirement already satisfied: scipy&gt;=0.13.0 in /usr/local/lib/python3.7/dist-packages (from dedalus) (1.4.1)
Requirement already satisfied: pytest in /usr/local/lib/python3.7/dist-packages (from dedalus) (4.3.1)
Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from dedalus) (1.21.5)
Requirement already satisfied: cached-property in /usr/local/lib/python3.7/dist-packages (from h5py&gt;=2.10.0-&gt;dedalus) (1.5.2)
Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,&gt;=2.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;dedalus) (3.0.7)
Requirement already satisfied: cycler&gt;=0.10 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;dedalus) (0.11.0)
Requirement already satisfied: python-dateutil&gt;=2.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;dedalus) (2.8.2)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;dedalus) (1.4.0)
Requirement already satisfied: typing-extensions in /usr/local/lib/python3.7/dist-packages (from kiwisolver&gt;=1.0.1-&gt;matplotlib-&gt;dedalus) (3.10.0.2)
Requirement already satisfied: six&gt;=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil&gt;=2.1-&gt;matplotlib-&gt;dedalus) (1.15.0)
Requirement already satisfied: attrs&gt;=17.4.0 in /usr/local/lib/python3.7/dist-packages (from pytest-&gt;dedalus) (21.4.0)
Requirement already satisfied: py&gt;=1.5.0 in /usr/local/lib/python3.7/dist-packages (from pytest-&gt;dedalus) (1.11.0)
Requirement already satisfied: pluggy&gt;=0.7 in /usr/local/lib/python3.7/dist-packages (from pytest-&gt;dedalus) (0.7.1)
Requirement already satisfied: setuptools in /usr/local/lib/python3.7/dist-packages (from pytest-&gt;dedalus) (57.4.0)
Requirement already satisfied: atomicwrites&gt;=1.0 in /usr/local/lib/python3.7/dist-packages (from pytest-&gt;dedalus) (1.4.0)
Requirement already satisfied: more-itertools&gt;=4.0.0 in /usr/local/lib/python3.7/dist-packages (from pytest-&gt;dedalus) (8.12.0)
Requirement already satisfied: py-cpuinfo in /usr/local/lib/python3.7/dist-packages (from pytest-benchmark-&gt;dedalus) (8.0.0)
Requirement already satisfied: coverage&gt;=4.4 in /usr/local/lib/python3.7/dist-packages (from pytest-cov-&gt;dedalus) (6.3.2)
Building wheels for collected packages: dedalus
  Building wheel for dedalus (PEP 517) ... ?25l?25hdone
  Created wheel for dedalus: filename=dedalus-2.2006-cp37-cp37m-linux_x86_64.whl size=1289070 sha256=5ab90d3ead211c03f6130c8e908ce83f871e931dac23d31ece025506d0fa395a
  Stored in directory: /root/.cache/pip/wheels/5d/fb/3a/61d89cbb71c8f0a01732855dd91d8f087b278cc00781093b4f
Successfully built dedalus
Installing collected packages: dedalus
Successfully installed dedalus-2.2006
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/content/gdrive&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mounted at /content/gdrive
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>ls /content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s*.h5
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s10.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s11.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s12.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s13.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s14.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s15.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s16.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s17.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s18.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s19.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s1.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s20.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s21.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s22.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s23.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s24.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s25.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s26.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s27.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s28.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s29.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s2.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s30.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s31.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s32.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s33.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s34.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s35.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s36.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s3.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s4.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s5.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s6.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s7.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s8.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s9.h5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mv /content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots /content/snapshots 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">dedalus.public</span> <span class="k">as</span> <span class="nn">de</span>
<span class="kn">from</span> <span class="nn">dedalus.extras</span> <span class="kn">import</span> <span class="n">flow_tools</span>
<span class="kn">from</span> <span class="nn">dedalus.tools</span> <span class="kn">import</span> <span class="n">post</span>
<span class="c1">#Merging analysis files</span>
<span class="n">post</span><span class="o">.</span><span class="n">merge_process_files</span><span class="p">(</span><span class="s2">&quot;snapshots&quot;</span><span class="p">,</span> <span class="n">cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">set_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;snapshots&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;snapshots_s*.h5&quot;</span><span class="p">))</span>
<span class="n">post</span><span class="o">.</span><span class="n">merge_sets</span><span class="p">(</span><span class="s2">&quot;snapshots/snapshots.h5&quot;</span><span class="p">,</span> <span class="n">set_paths</span><span class="p">,</span> <span class="n">cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-04-06 03:58:05,000 post 0/1 INFO :: Merging files from snapshots
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-8-c99b0d5c0d75&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">post</span><span class="o">.</span><span class="n">merge_process_files</span><span class="p">(</span><span class="s2">&quot;snapshots&quot;</span><span class="p">,</span> <span class="n">cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">set_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;snapshots&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;snapshots_s*.h5&quot;</span><span class="p">))</span>
<span class="ne">----&gt; </span><span class="mi">8</span> <span class="n">post</span><span class="o">.</span><span class="n">merge_sets</span><span class="p">(</span><span class="s2">&quot;snapshots/snapshots.h5&quot;</span><span class="p">,</span> <span class="n">set_paths</span><span class="p">,</span> <span class="n">cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/dedalus/tools/post.py</span> in <span class="ni">merge_sets</span><span class="nt">(joint_path, set_paths, cleanup, comm)</span>
<span class="g g-Whitespace">    </span><span class="mi">289</span>         <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">set_path</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">290</span>             <span class="n">set_starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="s1">&#39;scales&#39;</span><span class="p">][</span><span class="s1">&#39;sim_time&#39;</span><span class="p">][:]))</span>
<span class="nn">--&gt; 291     set_starts, set_paths = zip(*[pair for pair</span> in <span class="ni">sorted(zip</span><span class="nt">(set_starts, set_paths))])</span>
<span class="g g-Whitespace">    </span><span class="mi">292</span> 
<span class="g g-Whitespace">    </span><span class="mi">293</span>     <span class="c1"># Find number of writes to extract from each set</span>

<span class="ne">ValueError</span>: not enough values to unpack (expected 2, got 0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build_s2_coord_vertices</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">phi_vert</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">phi</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">]])</span>
    <span class="n">phi_vert</span> <span class="o">-=</span> <span class="n">phi_vert</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">theta_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">theta_vert</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">],</span> <span class="n">theta_mid</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">phi_vert</span><span class="p">,</span> <span class="n">theta_vert</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save plot of specified tasks for given range of analysis writes.&quot;&quot;&quot;</span>
    <span class="c1"># Plot settings</span>
    <span class="n">task</span> <span class="o">=</span> <span class="s1">&#39;vorticity&#39;</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdBu_r</span>
    <span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">savename_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">write</span><span class="p">:</span> <span class="s1">&#39;write_</span><span class="si">{:06}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">write</span><span class="p">)</span>
    <span class="c1"># Create figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="c1"># Plot writes</span>
    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;tasks&#39;</span><span class="p">][</span><span class="n">task</span><span class="p">]</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">phi_vert</span><span class="p">,</span> <span class="n">theta_vert</span> <span class="o">=</span> <span class="n">build_s2_coord_vertices</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_vert</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_vert</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_vert</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_vert</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_vert</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span><span class="o">+</span><span class="n">count</span><span class="p">):</span>
            <span class="n">data_slices</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="n">data_slices</span><span class="p">]</span>
            <span class="n">clim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="o">-</span><span class="n">clim</span><span class="p">,</span> <span class="n">clim</span><span class="p">)</span>
            <span class="n">fc</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            <span class="c1">#fc[:, theta.size//2, :] = [0,0,0,1]  # black equator</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="n">start</span><span class="p">:</span>
                <span class="n">surf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="n">fc</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">surf</span><span class="o">.</span><span class="n">set_facecolors</span><span class="p">(</span><span class="n">fc</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">fc</span><span class="o">.</span><span class="n">size</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
            <span class="c1"># Save figure</span>
            <span class="n">savename</span> <span class="o">=</span> <span class="n">savename_func</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="s1">&#39;scales/write_number&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span>
            <span class="n">savepath</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">savename</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">savepath</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>rm list.txt
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">37</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;ls /content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.h5 &gt;&gt; list.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rm: cannot remove &#39;list.txt&#39;: No such file or directory
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mkdir /content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/figures
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;list.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
     <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
          <span class="n">newstr</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
          <span class="nb">print</span><span class="p">(</span><span class="n">newstr</span><span class="p">)</span>
          <span class="n">f</span>   <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">newstr</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s1.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s2.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s3.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s4.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s5.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s6.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s7.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s8.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s9.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s10.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s11.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s12.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s13.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s14.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s15.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s16.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s17.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s18.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s19.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s20.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s21.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s22.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s23.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s24.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s25.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s26.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s27.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s28.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s29.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s30.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s31.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s32.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s33.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s34.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s35.h5
/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s36.h5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> 


<span class="k">def</span> <span class="nf">build_s2_coord_vertices</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">phi_vert</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">phi</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">]])</span>
    <span class="n">phi_vert</span> <span class="o">-=</span> <span class="n">phi_vert</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">theta_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">theta_vert</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">],</span> <span class="n">theta_mid</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">phi_vert</span><span class="p">,</span> <span class="n">theta_vert</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>

<span class="n">count</span><span class="o">=</span><span class="mi">0</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;list.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
     <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
          <span class="n">newstr</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
          <span class="nb">print</span><span class="p">(</span><span class="n">newstr</span><span class="p">)</span>
          <span class="n">f</span>   <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">newstr</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
          <span class="n">vor</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;tasks&#39;</span><span class="p">][</span><span class="s1">&#39;vorticity&#39;</span><span class="p">]</span>
          <span class="n">dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vor</span><span class="p">)</span>
          <span class="c1"># Plot settings</span>
          <span class="n">task</span> <span class="o">=</span> <span class="s1">&#39;vorticity&#39;</span>
          <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdBu_r</span>
          <span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span>
          <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
          <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
          <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
          <span class="c1">#plt.contourf(vor[0,:,:].T)</span>
          <span class="n">phi</span> <span class="o">=</span> <span class="n">vor</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
          <span class="n">theta</span> <span class="o">=</span> <span class="n">vor</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
          <span class="n">phi_vert</span><span class="p">,</span> <span class="n">theta_vert</span> <span class="o">=</span> <span class="n">build_s2_coord_vertices</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
          <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_vert</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_vert</span><span class="p">)</span>
          <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_vert</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_vert</span><span class="p">)</span>
          <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_vert</span><span class="p">)</span>
          <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
              <span class="n">data_slices</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
              <span class="n">data</span> <span class="o">=</span> <span class="n">vor</span><span class="p">[</span><span class="n">data_slices</span><span class="p">]</span>
              <span class="n">clim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
              <span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="o">-</span><span class="n">clim</span><span class="p">,</span> <span class="n">clim</span><span class="p">)</span>
              <span class="n">fc</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
              <span class="c1">#fc[:, theta.size//2, :] = [0,0,0,1]  # black equator</span>
              <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                  <span class="n">surf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="n">fc</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                  <span class="c1">#ax.set_box_aspect((1,1,1))</span>
                  <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                  <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                  <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                  <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
              <span class="k">else</span><span class="p">:</span>
                  <span class="n">surf</span><span class="o">.</span><span class="n">set_facecolors</span><span class="p">(</span><span class="n">fc</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">fc</span><span class="o">.</span><span class="n">size</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
              <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span>
              <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/figures/&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
          <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="c1"># filepaths</span>
<span class="n">fp_in</span> <span class="o">=</span> <span class="s2">&quot;/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/figures/*.png&quot;</span>
<span class="n">fp_out</span> <span class="o">=</span> <span class="s2">&quot;/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/figures/image.gif&quot;</span>

<span class="c1"># https://pillow.readthedocs.io/en/stable/handbook/image-file-formats.html#gif</span>
<span class="n">imgs</span> <span class="o">=</span> <span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">fp_in</span><span class="p">)))</span>
<span class="n">img</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">imgs</span><span class="p">)</span>  <span class="c1"># extract first image from iterator</span>
<span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fp</span><span class="o">=</span><span class="n">fp_out</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;GIF&#39;</span><span class="p">,</span> <span class="n">append_images</span><span class="o">=</span><span class="n">imgs</span><span class="p">,</span>
         <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">316</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;mv /content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/figures/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png /content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/figures/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span>   <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/website-hugo/chaos_and_predictability/week3/RB2D/2D_shallow_water_output/snapshots/snapshots_s2.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">vor</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;tasks&#39;</span><span class="p">][</span><span class="s1">&#39;vorticity&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">eq_eval</span><span class="p">(</span><span class="n">eq_str</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">split_equation</span><span class="p">(</span><span class="n">eq_str</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eq_eval</span><span class="p">(</span><span class="s2">&quot;u = 0&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-2-f1c3dc5bb1e9&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">eq_eval</span><span class="p">(</span><span class="s2">&quot;u = 0&quot;</span><span class="p">)</span>

<span class="nn">&lt;ipython-input-1-78d4b9596683&gt;</span> in <span class="ni">eq_eval</span><span class="nt">(eq_str)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span> <span class="nf">eq_eval</span><span class="p">(</span><span class="n">eq_str</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="k">return</span> <span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">split_equation</span><span class="p">(</span><span class="n">eq_str</span><span class="p">)]</span>

<span class="ne">NameError</span>: name &#39;split_equation&#39; is not defined
</pre></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./week3/RB2D"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Kai-Chih Tseng<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>